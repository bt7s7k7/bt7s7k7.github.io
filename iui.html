<html>
	<head>
		<script src="stuff/bUtils.js"></script>
		<script src="stuff/iui.js"></script>
		<link rel="stylesheet" type="text/css" href="stuff/btStyle.css">
		<script>
			var ctx
			var iui
			var wins
			var bootingTime = -1
			var menus = {
				start: false
			}
			var sysTestActive = false
			var sysTestNum = 0
			var startButtons = [
				{name:"Shutdown",func:()=>{location.search = ""}},
				{name:"Reboot",func:()=>{location.search = "autoboot=true"}},
				{name:"Settings",func:()=>{
					wins.create({size:[500,750],label:"Settings"},{pos:ctx.getSize().mul(0.5).add([-250,-375])},(gui)=>{
						[
							"Background color",
							"User name",
							"Password",
							"Background image",
							"Screensaver",
							"Language",
							"Certificate",
							"System theme",
							"Mouse sensitivity",
							"Gamma",
							"Narrator",
							"System key",
							"Default browser",
							"Desktop icons",
							"Firewall",
							"Network",
							"Bluetooth",
							"Defragmention"
						].forEach((v,i)=>{
							gui.text({txt:v + ": ",pos:[10,50 + 40 * i]})
							if (gui.button({pos:[200,30 + 40 * i],size:[50,30],txt:"OPTIONS"}).test.lClick) {
								wins.openDialog("alert",gui,"Critical error","Feature not implemented yet")
							}
						})
					})
				}},
				{name:"System",func:()=>{
					wins.create({size:[500,250],label:"System"},{pos:ctx.getSize().mul(0.5).add([1,1].mul(-255))},(gui)=>{
						ctx.setColor(colors.yellow).ellipse(gui.pos.add([60,100]),[50,50])
						gui.text({pos:[120,140],txt:"BtOS",textHeight:100})
						gui.text({pos:[20,170],txt:"Version: Alpha-1.3\nSystem UUID: {e5a3f-b156-a1f5-1435}\nTime: [ERROR: Clock not implemented]"})
					})
				}},
				{name:"sysTest.exe",func:()=>{
					sysTestActive = true
				}},
			]
			function setup() {
				ctx = new CanvasUtil(B.canvas)
				iui = new ImmediateUI(ctx)
				iui.enabled = false
				wins = new IUIWindowMan()
				ctx.setColor(colors.black).fill()
				
				window.addEventListener("click",()=>{
					if (bootingTime == -1) {
						bootingTime = 0
					}
				})
				if (B.get["autoboot"]) {
					bootingTime = 0
				}

				iui.update()
				window.addEventListener("resize",(event)=>{
					resize(event)
				})
				resize()
			}
			
			function update() {
				iui.update()
				if (bootingTime == -1) {
					ctx.setColor(colors.black).fill()
				}
				if (bootingTime < 110 && bootingTime > -1) {
					ctx.setColor(colors.black).fill().setColor(colors.yellow)
					bootingTime += 1
					let segL = 1
					ctx.strokeEllipse(ctx.getSize().mul(0.5), [1, 1].mul(200), 10, [(Math.PI * 2.25) * (bootingTime / 100 * 1) + (Math.PI * 0.25), (Math.PI) * (bootingTime / 100 * 2)])
					/*Array.getFilled(200 / segL).forEach((v,i)=>{
						var g = 200 / segL - i
						ctx.setColor(colors.yellow)
						
						ctx.setColor(colors.black)
						ctx.ellipse(ctx.getSize().mul(0.5),[1,1].mul(g * segL - segL))
					})*/
				}
				if (bootingTime == 110) {
					iui.layers.ground.push((gui)=>{
						wins.drawWindows(gui)
						wins.drawTaskbar([30,ctx.getSize()[1] - 30],[ctx.getSize()[0],30],colors.grey,colors.black,gui)
						{ //Start Menu
							let butt = gui.button({pos:[0,ctx.getSize()[1] - 30],size:[30,30],color:colors.black})
							if (butt.test.lClick) {
								menus.start = !menus.start
							}
							if (menus.start) {
								let base = gui.rect({pos:[0,ctx.getSize()[1] - (startButtons.length * 30 + 30)],size:[200,startButtons.length * 30],color:colors.darkGrey})
								base.rect({pos:[0,0],size:[27,startButtons.length * 30],color:colors.voidGrey})
								startButtons.forEach((v,i)=>{
									var butt = base.button({pos:[30,i * 30],size:[170,30],color:colors.darkGrey,txt:v.name,textHeight:20,center:false})
									if (butt.test.lClick) {
										v.func()
										menus.start = false
									}
								})
							}
						}
						ctx.setColor(colors.yellow).ellipse([15,ctx.getSize()[1] - 15],[10,10])
						if (sysTestActive) {
							var mcolors = [colors.green,colors.red,colors.blue,colors.pink,colors.white,colors.yellow]
							var sysTestArray = []
							repeat(sysTestNum * 10,()=>{
								sysTestArray.push([
									Math.floor((Math.random() * ctx.getSize()[0]) / 10) * 10,
									Math.floor((Math.random() * ctx.getSize()[1])),
									mcolors.random()
								])
							})
							
							if (sysTestNum > 100) {
								location.search = "autoboot=true"
							}
							sysTestArray.forEach((v=>{
								ctx.setColor(v[2]).box(v.add([-150,0]),[300,1])
							}))
							sysTestNum++
						}
					})
					iui.enabled = true
					bootingTime++
				}
			}
			
			function resize() {
				B.canvas.canvas.height = window.innerHeight
				B.canvas.canvas.width = window.innerWidth
			}
		</script>
	</head>
	<body>
		<canvas height="500" width="500" style="position:absolute;top:0px;left:0px"></canvas>
	</body>
</html>